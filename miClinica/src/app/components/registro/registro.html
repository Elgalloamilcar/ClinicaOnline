<div class="registro-container">
  <mat-card class="registro-card">
    
    <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

    <mat-card-header>
      <mat-card-title>Registro de Usuario</mat-card-title>
      <mat-card-subtitle>Sprint 1: Alta de Pacientes y Especialistas</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="registro-form">
        
        <!-- SELECCI√ìN DE ROL -->
        <div class="rol-selection">
          <mat-radio-group formControlName="rol" class="rol-group">
            <mat-radio-button value="paciente">üë§ Paciente</mat-radio-button>
            <mat-radio-button value="especialista">üë®‚Äç‚öïÔ∏è Especialista</mat-radio-button>
          </mat-radio-group>
        </div>

        <!-- DATOS COMUNES -->
        <div class="row-inputs">
          <mat-form-field appearance="outline" class="half">
            <mat-label>Nombre</mat-label>
            <input matInput formControlName="nombre">
            <mat-error>Requerido</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="half">
            <mat-label>Apellido</mat-label>
            <input matInput formControlName="apellido">
            <mat-error>Requerido</mat-error>
          </mat-form-field>
        </div>

        <div class="row-inputs">
          <mat-form-field appearance="outline" class="half">
            <mat-label>Edad</mat-label>
            <input matInput type="number" formControlName="edad">
          </mat-form-field>
          <mat-form-field appearance="outline" class="half">
            <mat-label>DNI</mat-label>
            <input matInput type="number" formControlName="dni">
          </mat-form-field>
        </div>

        <!-- DATOS ESPEC√çFICOS: PACIENTE -->
        <div *ngIf="esPaciente()" class="specific-section fade-in">
          <h3 class="section-title">Datos de Paciente</h3>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Obra Social</mat-label>
            <input matInput formControlName="obraSocial" placeholder="Ej: OSDE, IOMA">
            <mat-error>Requerido para pacientes</mat-error>
          </mat-form-field>
        </div>

        <!-- DATOS ESPEC√çFICOS: ESPECIALISTA -->
        <div *ngIf="esEspecialista()" class="specific-section fade-in">
          <h3 class="section-title">Datos Profesionales</h3>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Especialidad</mat-label>
            <mat-select formControlName="especialidad">
              <mat-option *ngFor="let esp of especialidades" [value]="esp.nombre">
                {{ esp.nombre }}
              </mat-option>
              <mat-divider></mat-divider>
              <mat-option value="otra">‚ûï Agregar nueva...</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Input extra si elige "Otra" -->
          <mat-form-field *ngIf="form.get('especialidad')?.value === 'otra'" appearance="outline" class="full-width fade-in">
            <mat-label>Escriba la nueva especialidad</mat-label>
            <input matInput formControlName="otraEspecialidad">
          </mat-form-field>
        </div>

        <!-- DATOS DE ACCESO -->
        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" type="email">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Contrase√±a</mat-label>
          <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password">
          <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
        </mat-form-field>

        <!-- SUBIDA DE IM√ÅGENES -->
        <div class="file-upload-section">
          <p class="upload-label">Im√°genes de Perfil</p>
          
          <div class="upload-btn-wrapper">
            <button type="button" mat-stroked-button (click)="fileInput1.click()">
              <mat-icon>image</mat-icon> {{ imagen1 ? imagen1.name : 'Foto Perfil 1 (Requerida)' }}
            </button>
            <input #fileInput1 type="file" (change)="onFileSelected($event, 1)" hidden accept="image/*">
          </div>

          <div class="upload-btn-wrapper" *ngIf="esPaciente()">
            <button type="button" mat-stroked-button (click)="fileInput2.click()">
              <mat-icon>image</mat-icon> {{ imagen2 ? imagen2.name : 'Foto Perfil 2 (Requerida)' }}
            </button>
            <input #fileInput2 type="file" (change)="onFileSelected($event, 2)" hidden accept="image/*">
          </div>
        </div>

        <button mat-raised-button color="primary" type="submit" [disabled]="loading || form.invalid" class="submit-btn">
          REGISTRARSE
        </button>

      </form>
    </mat-card-content>
    <mat-card-footer>
        <p>¬øYa tienes cuenta? <a routerLink="/login">Ingresa aqu√≠</a></p>
    </mat-card-footer>
  </mat-card>
</div>