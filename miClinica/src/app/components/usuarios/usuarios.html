<div class="usuarios-container">
  
  <div class="header-section">
    <h2>Gesti√≥n de Usuarios</h2>
    <button mat-raised-button color="primary" routerLink="/usuarios/nuevo">
      <mat-icon>person_add</mat-icon> Nuevo Admin/Usuario
    </button>
  </div>

  <div class="table-wrapper mat-elevation-z8">
    <table mat-table [dataSource]="usuarios">

      <!-- Nombre y Apellido -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef> Usuario </th>
        <td mat-cell *matCellDef="let user"> 
          <div class="user-cell">
            <div class="avatar-mini">{{ user.nombre.charAt(0) }}</div>
            <div class="text-data">
              <span class="name">{{ user.nombre }} {{ user.apellido }}</span>
              <span class="dni">DNI: {{ user.dni }}</span>
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Rol -->
      <ng-container matColumnDef="rol">
        <th mat-header-cell *matHeaderCellDef> Rol </th>
        <td mat-cell *matCellDef="let user">
          <mat-chip-set>
            <mat-chip [color]="user.rol === 'administrador' ? 'warn' : (user.rol === 'especialista' ? 'accent' : 'primary')" selected>
              {{ user.rol | titlecase }}
            </mat-chip>
          </mat-chip-set>
        </td>
      </ng-container>

      <!-- Edad -->
      <ng-container matColumnDef="edad">
        <th mat-header-cell *matHeaderCellDef> Edad </th>
        <td mat-cell *matCellDef="let user"> {{ user.edad }} </td>
      </ng-container>

      <!-- Habilitado (Switch) -->
      <ng-container matColumnDef="habilitado">
        <th mat-header-cell *matHeaderCellDef> Acceso </th>
        <td mat-cell *matCellDef="let user">
          <!-- Solo mostramos el switch si NO es admin (para no auto-bloquearse) -->
          <mat-slide-toggle 
            *ngIf="user.rol !== 'administrador'"
            [checked]="user.cuenta_habilitada"
            (change)="toggleHabilitar(user)"
            color="primary">
            {{ user.cuenta_habilitada ? 'Activo' : 'Bloqueado' }}
          </mat-slide-toggle>
        </td>
      </ng-container>

      <!-- Acciones (Ver detalle, etc) -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef> </th>
        <td mat-cell *matCellDef="let user">
          <button mat-icon-button color="primary">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</div>
